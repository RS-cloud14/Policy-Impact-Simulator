<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Policy Impact Simulator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f6fa;
            height: 100vh;
            overflow: hidden;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 380px;
            grid-template-rows: auto auto auto 1fr;
            height: 100vh;
            gap: 15px;
            padding: 15px;
        }
        
        /* Header */
        .main-header {
            grid-column: 1 / 3;
            grid-row: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 30px;
            border-radius: 12px;
            text-align: center;
        }
        
        .main-header h1 {
            font-size: 24px;
            margin-bottom: 3px;
        }
        
        .main-header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* Main Content */
        .main-content {
            grid-column: 1 / 2;
            grid-row: 2 / 5;
            display: grid;
            grid-template-rows: auto auto 1fr;
            gap: 15px;
            overflow: hidden;
        }
        
        /* Scenarios Section */
        .scenarios-section {
            background: white;
            border-radius: 10px;
            padding: 18px 20px;
        }
        
        .scenarios-section h2 {
            color: #2c3e50;
            font-size: 16px;
            margin-bottom: 12px;
        }
        
        .scenarios-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        
        .scenario-card {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .scenario-card:hover {
            border-color: #3498db;
        }
        
        .scenario-card.active {
            border-color: #3498db;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .scenario-card h3 {
            font-size: 15px;
            margin-bottom: 6px;
        }
        
        .scenario-card p {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 8px;
        }
        
        .scenario-details {
            font-size: 11px;
            padding-top: 8px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }
        
        /* Controls */
        .controls-section {
            background: white;
            border-radius: 10px;
            padding: 18px 20px;
        }
        
        .controls-section h2 {
            color: #2c3e50;
            font-size: 16px;
            margin-bottom: 12px;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 18px;
        }
        
        .control-group label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 13px;
        }
        
        .slider {
            width: 100%; height: 6px; border-radius: 3px; background: #e0e0e0;
            outline: none; -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none; width: 18px; height: 18px;
            border-radius: 50%; background: #3498db; cursor: pointer;
        }
        
        .slider::-moz-range-thumb {
            width: 18px; height: 18px; border-radius: 50%; background: #3498db;
            cursor: pointer; border: none;
        }
        
        .slider-value {
            display: flex; justify-content: space-between; margin-top: 6px;
            font-size: 11px;
            color: #95a5a6;
        }
        
        .current-value {
            font-weight: bold; color: #3498db; font-size: 14px;
        }
        
        /* Results */
        .results-section {
            background: white; border-radius: 10px; padding: 18px 20px;
            overflow-y: auto; display: flex; flex-direction: column;
        }
        
        .results-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 12px;
        }
        
        .results-header h2 {
            color: #2c3e50; font-size: 16px;
        }
        
        .results-header-buttons { display: flex; gap: 8px; }
        
        .action-btn {
            padding: 8px 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; border-radius: 6px; cursor: pointer;
            font-size: 12px;
            font-weight: bold; transition: transform 0.2s;
        }
        
        .action-btn:hover { transform: scale(1.05); }
        
        .key-metrics {
            display: grid; grid-template-columns: repeat(3, 1fr);
            gap: 10px; margin-bottom: 12px;
        }
        
        /* === MODIFIED SECTION START === */
        .metric-card {
            background: linear-gradient(135deg, #0d164f 0%, #293a80 100%); /* MODIFIED: Changed to gradient */
            padding: 15px 12px;
            border-radius: 12px;
            color: white; 
            text-align: center;
        }
        
        .metric-card h3 {
            font-size: 14px;
            opacity: 0.9; 
            margin-bottom: 8px;
        }
        
        .metric-card .value {
            font-size: 28px;
            font-weight: bold; 
            margin-bottom: 5px;
        }
        
        .metric-card .subtitle {
            font-size: 11px;
            opacity: 0.85;
        }
        /* === MODIFIED SECTION END === */
        
        .sector-section { margin-bottom: 12px; }
        
        .sector-section h3 {
            color: #2c3e50; font-size: 14px;
            margin-bottom: 8px;
        }
        
        .sector-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;
        }
        
        .sector-card {
            background: #f8f9fa; border: 1px solid #e0e0e0;
            border-radius: 6px; padding: 10px;
        }
        
        .sector-card h4 {
            font-size: 13px;
            color: #2c3e50; margin-bottom: 6px;
        }
        
        .sector-stat {
            display: flex; justify-content: space-between; margin-bottom: 4px;
            font-size: 12px;
        }
        
        .sector-stat .label { color: #7f8c8d; }
        .sector-stat .value { color: #2c3e50; font-weight: 600; }
        
        .additional-impacts {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;
        }
        
        .impact-card {
            background: #f8f9fa; border: 1px solid #e0e0e0;
            border-radius: 6px; padding: 10px; text-align: center;
        }
        
        .impact-card h4 {
            font-size: 11px;
            color: #7f8c8d; margin-bottom: 5px;
        }
        
        .impact-value {
            font-size: 18px;
            font-weight: bold; color: #3498db; margin-bottom: 3px;
        }
        
        .impact-description {
            font-size: 10px;
            color: #95a5a6; line-height: 1.3;
        }
        
        /* Chat Section */
        .chat-section {
            grid-column: 2 / 3; grid-row: 2 / 5; background: white;
            border-radius: 12px; display: flex; flex-direction: column;
            overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 12px; text-align: center;
        }
        
        .chat-header h2 { font-size: 16px; margin-bottom: 3px; }
        .chat-header p { font-size: 11px; opacity: 0.9; }
        
        .quick-questions {
            padding: 8px; background: #f8f9fa; border-bottom: 1px solid #e0e0e0;
            display: flex; flex-wrap: wrap; gap: 5px;
        }
        
        .quick-question-btn {
            padding: 5px 8px; background: white; border: 1px solid #d0d0d0;
            border-radius: 12px; cursor: pointer; font-size: 10px;
            color: #333; transition: all 0.2s;
        }
        
        .quick-question-btn:hover { background: #3498db; color: white; }
        
        .chat-messages {
            flex: 1; overflow-y: auto; padding: 12px; background: #fafafa;
        }
        
        .message { margin-bottom: 10px; display: flex; animation: slideIn 0.3s ease; }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.user { justify-content: flex-end; }
        
        .message-content {
            max-width: 80%; padding: 8px 10px; border-radius: 12px;
            word-wrap: break-word; line-height: 1.4; font-size: 12px;
        }
        
        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .message.assistant .message-content {
            background: white; color: #333; border: 1px solid #e0e0e0;
        }
        
        .chat-input {
            padding: 10px; background: white; border-top: 1px solid #e0e0e0;
            display: flex; gap: 6px;
        }
        
        .chat-input input {
            flex: 1; padding: 7px 10px; border: 2px solid #e0e0e0;
            border-radius: 20px; font-size: 12px; outline: none;
        }
        
        .chat-input input:focus { border-color: #3498db; }
        
        .chat-input button {
            padding: 7px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; border-radius: 20px; cursor: pointer;
            font-weight: bold; font-size: 12px;
        }
        
        .chat-input button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* Modal Styles (Shared) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); display: none; align-items: center;
            justify-content: center; z-index: 1000;
        }
        .modal-overlay.show { display: flex; }
        .modal-content {
            background: white; padding: 25px; border-radius: 12px; width: 90%;
            max-width: 650px; max-height: 80vh; overflow-y: auto; position: relative;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1.0); }
        }
        .modal-close-btn {
            position: absolute; top: 10px; right: 15px; background: none;
            border: none; font-size: 24px; cursor: pointer; color: #7f8c8d;
        }
        .modal-content h2 { color: #2c3e50; margin-bottom: 15px; font-size: 19px; }
        
        /* Methodology Modal Specifics */
        .method-item { margin-bottom: 12px; }
        .method-item h3 { font-size: 15px; color: #34495e; margin-bottom: 5px; }
        .method-item p, .method-item ul { font-size: 13px; line-height: 1.6; color: #555; }
        .method-item ul { list-style-position: inside; padding-left: 5px; }
        .method-item .source { font-size: 11px; color: #7f8c8d; font-style: italic; }

        /* Report Modal Styles */
        .report-modal-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px;
        }
        #reportOutput {
            background-color: #f8f9fa; border: 1px solid #e0e0e0;
            border-radius: 6px; padding: 15px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 12px; white-space: pre-wrap;
            word-wrap: break-word; max-height: 50vh; overflow-y: auto;
        }
        #copyReportBtn {
            padding: 8px 16px; background: #27ae60; color: white; border: none;
            border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 12px;
        }
        #copyReportBtn:hover { background: #2ecc71; }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-header">
            <h1>üéØ Policy Impact Simulator</h1>
            <p>Model the economic impact of older worker employment policies and interventions</p>
        </div>
        
        <div class="main-content">
             <div class="scenarios-section">
                <h2>üìã Select Policy Scenario</h2>
                <div class="scenarios-grid">
                    <div class="scenario-card" onclick="loadPreset('high')">
                        <h3>üöÄ High</h3>
                        <p>Aggressive intervention</p>
                        <div class="scenario-details">300K workers, 0.90 prod, Age 65</div>
                    </div>
                    <div class="scenario-card active" onclick="loadPreset('moderate')">
                        <h3>‚ö° Moderate</h3>
                        <p>Realistic outcomes</p>
                        <div class="scenario-details">150K workers, 0.85 prod, Age 63</div>
                    </div>
                    <div class="scenario-card" onclick="loadPreset('low')">
                        <h3>üìä Low</h3>
                        <p>Conservative approach</p>
                        <div class="scenario-details">75K workers, 0.80 prod, Age 61</div>
                    </div>
                </div>
            </div>
            
            <div class="controls-section">
                <h2>üéõÔ∏è Customize Your Scenario</h2>
                <div class="controls-grid">
                    <div class="control-group">
                        <label>Additional Senior Workers (55+)</label>
                        <input type="range" class="slider" id="workersSlider" min="0" max="500000" step="10000" value="150000" oninput="updateSimulation()">
                        <div class="slider-value">
                            <span>0</span><span class="current-value" id="workersValue">150,000</span><span>500K</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Productivity Factor</label>
                        <input type="range" class="slider" id="productivitySlider" min="0.70" max="0.95" step="0.01" value="0.85" oninput="updateSimulation()">
                        <div class="slider-value">
                            <span>0.70</span><span class="current-value" id="productivityValue">0.85</span><span>0.95</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Retirement Age (Years)</label>
                        <input type="range" class="slider" id="retirementSlider" min="60" max="70" step="1" value="63" oninput="updateSimulation()">
                        <div class="slider-value">
                            <span>60</span><span class="current-value" id="retirementValue">63</span><span>70</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="results-section">
                <div class="results-header">
                    <h2>üìà Projected Economic Impact</h2>
                    <div class="results-header-buttons">
                        <button class="action-btn" onclick="showMethodology()">Methodology</button>
                        <button class="action-btn" onclick="showReport()">üìÑ Show Report</button>
                    </div>
                </div>
                
                <div class="key-metrics">
                    <div class="metric-card">
                        <h3>GDP Impact</h3>
                        <div class="value" id="gdpImpact">RM 27.2B</div><div class="subtitle">Annual contribution</div>
                    </div>
                    <div class="metric-card">
                        <h3>Employment Rate</h3>
                        <div class="value" id="employmentRate">+1.5%</div><div class="subtitle">LFPR increase</div>
                    </div>
                    <div class="metric-card">
                        <h3>Workers Retained</h3>
                        <div class="value" id="workersRetained">300K</div><div class="subtitle">Additional employed</div>
                    </div>
                </div>
                <div class="sector-section"><h3>üè¢ Impact by Sector</h3><div class="sector-grid">
                        <div class="sector-card"><h4>üåæ Agriculture</h4><div class="sector-stat"><span class="label">GDP:</span><span class="value" id="agriGDP">RM 252M</span></div><div class="sector-stat"><span class="label">Workers:</span><span class="value" id="agriWorkers">15K</span></div></div>
                        <div class="sector-card"><h4>üè≠ Manufacturing</h4><div class="sector-stat"><span class="label">GDP:</span><span class="value" id="manuGDP">RM 1.83B</span></div><div class="sector-stat"><span class="label">Workers:</span><span class="value" id="manuWorkers">90K</span></div></div>
                        <div class="sector-card"><h4>üíº Services</h4><div class="sector-stat"><span class="label">GDP:</span><span class="value" id="servGDP">RM 2.39B</span></div><div class="sector-stat"><span class="label">Workers:</span><span class="value" id="servWorkers">195K</span></div></div>
                </div></div>
                <div class="sector-section"><h3>üí∞ Additional Benefits</h3><div class="additional-impacts">
                        <div class="impact-card"><h4>Tax Revenue</h4><div class="impact-value" id="taxRevenue">RM 3.4B</div><div class="impact-description">Additional income tax collected</div></div>
                        <div class="impact-card"><h4>Pension Savings</h4><div class="impact-value" id="pensionSavings">RM 2.1B</div><div class="impact-description">EPF contributions</div></div>
                        <div class="impact-card"><h4>Social Costs</h4><div class="impact-value" id="socialCosts">RM 890M</div><div class="impact-description">Reduced welfare spending</div></div>
                        <div class="impact-card"><h4>Knowledge</h4><div class="impact-value" id="knowledgeValue">High</div><div class="impact-description">Mentoring younger generation</div></div>
                </div></div>
            </div>
        </div>
        
        <div class="chat-section">
            <div class="chat-header"><h2>ü§ñ Policy AI Assistant</h2><p>Ask about scenarios and implementation</p></div>
            <div class="quick-questions">
                <button class="quick-question-btn" onclick="askQuestion('What policies for High Impact?')">High Impact policies?</button>
                <button class="quick-question-btn" onclick="askQuestion('How does productivity work?')">Productivity factor?</button>
                <button class="quick-question-btn" onclick="askQuestion('Implementation costs?')">Costs?</button>
                <button class="quick-question-btn" onclick="askQuestion('Compare scenarios')">Compare scenarios</button>
            </div>
            <div class="chat-messages" id="chatMessages"></div>
            <div class="chat-input"><input type="text" id="messageInput" placeholder="Ask about policy impacts..." onkeypress="handleKeyPress(event)"><button onclick="sendMessage()" id="sendBtn">Send</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="methodologyModal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="hideMethodology()">&times;</button>
            <h2>Methodology & Data Sources</h2>
            <div class="method-item"><h3>GDP Impact Calculation</h3><p>The total GDP impact is calculated using a formula...</p><ul><li><b>Formula:</b> Workers √ó Productivity Factor √ó Retirement Factor √ó Base Productivity</li><li><b>Base Productivity:</b> RM99,265 per worker annually.</li></ul><p class="source">Source: Ministry of Investment, Trade and Industry (MITI) 2024</p></div>
            <div class="method-item"><h3>Tax Revenue</h3><p>This is the estimated additional income tax collected...</p><ul><li><b>Assumed Average Salary:</b> RM60,000 per year.</li><li><b>Average Effective Tax Rate:</b> 6%.</li></ul><p class="source">Source: Inland Revenue Board Malaysia (LHDN)</p></div>
            <div class="method-item"><h3>Pension Savings (EPF)</h3><p>Represents the total mandatory contributions...</p><ul><li><b>Employee Contribution:</b> 11% of gross salary.</li><li><b>Employer Contribution:</b> 12% of gross salary.</li><li><b>Total Contribution:</b> 23%.</li></ul><p class="source">Source: Employees Provident Fund (KWSP) 2024</p></div>
            <div class="method-item"><h3>Social Cost Savings</h3><p>This figure estimates the reduction in government spending...</p><ul><li><b>Annual Savings per Person:</b> RM7,200.</li></ul><p class="source">Source: Malaysia Budget 2025</p></div>
            <div class="method-item"><h3>Sector Distribution</h3><p>The total number of workers is distributed across major economic sectors...</p><ul><li><b>Agriculture:</b> 5% of workforce</li><li><b>Manufacturing:</b> 30% of workforce</li><li><b>Services:</b> 65% of workforce</li></ul><p class="source">Source: Department of Statistics Malaysia (DOSM)</p></div>
        </div>
    </div>

    <div class="modal-overlay" id="reportModal">
        <div class="modal-content">
            <div class="report-modal-header">
                <h2>Scenario Report</h2>
                <button id="copyReportBtn" onclick="copyReport()">üìã Copy to Clipboard</button>
            </div>
            <button class="modal-close-btn" onclick="hideReport()">&times;</button>
            <pre id="reportOutput"></pre>
        </div>
    </div>


    <script>
        const API_URL = 'https://wonderful-torte-91586c.netlify.app/api/chat';
        
        const PRODUCTIVITY_PER_WORKER = 99265;
        const EPF_TOTAL_RATE = 0.23;
        const AVG_TAX_RATE = 0.06;
        const WELFARE_SAVINGS_PER_PERSON = 7200;
        
        const presets = {
            high: { workers: 300000, productivity: 0.90, retirement: 65 },
            moderate: { workers: 150000, productivity: 0.85, retirement: 63 },
            low: { workers: 75000, productivity: 0.80, retirement: 61 }
        };
        
        function loadPreset(type) {
            const preset = presets[type];
            document.getElementById('workersSlider').value = preset.workers;
            document.getElementById('productivitySlider').value = preset.productivity;
            document.getElementById('retirementSlider').value = preset.retirement;
            
            document.querySelectorAll('.scenario-card').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.scenario-card').classList.add('active');
            updateSimulation();
        }
        function updateSimulation() {
            const workers = parseInt(document.getElementById('workersSlider').value);
            const productivity = parseFloat(document.getElementById('productivitySlider').value);
            const retirement = parseInt(document.getElementById('retirementSlider').value);
            
            document.getElementById('workersValue').textContent = workers.toLocaleString();
            document.getElementById('productivityValue').textContent = productivity.toFixed(2);
            document.getElementById('retirementValue').textContent = retirement;
            
            const retirementFactor = 1 + ((retirement - 60) * 0.02);
            const effectiveGdpContribution = workers * productivity * retirementFactor * PRODUCTIVITY_PER_WORKER;
            const gdpImpactInBillion = effectiveGdpContribution / 1000000000;
            
            document.getElementById('gdpImpact').textContent = `RM ${gdpImpactInBillion.toFixed(1)}B`;
            const employmentIncrease = (workers / 21000000 * 100);
            document.getElementById('employmentRate').textContent = `+${employmentIncrease.toFixed(1)}%`;
            document.getElementById('workersRetained').textContent = `${(workers / 1000).toFixed(0)}K`;
            
            const agriWorkers = Math.floor(workers * 0.05);
            const manuWorkers = Math.floor(workers * 0.30);
            const servWorkers = workers - agriWorkers - manuWorkers;
            
            document.getElementById('agriWorkers').textContent = `${(agriWorkers / 1000).toFixed(0)}K`;
            document.getElementById('manuWorkers').textContent = `${(manuWorkers / 1000).toFixed(0)}K`;
            document.getElementById('servWorkers').textContent = `${(servWorkers / 1000).toFixed(0)}K`;
            document.getElementById('agriGDP').textContent = `RM ${(gdpImpactInBillion * 0.05).toFixed(2)}B`;
            document.getElementById('manuGDP').textContent = `RM ${(gdpImpactInBillion * 0.30).toFixed(2)}B`;
            document.getElementById('servGDP').textContent = `RM ${(gdpImpactInBillion * 0.65).toFixed(2)}B`;
            
            const avgSalary = 60000;
            const totalSalaries = workers * avgSalary;
            const taxRevenue = (totalSalaries * AVG_TAX_RATE) / 1000000000;
            document.getElementById('taxRevenue').textContent = `RM ${taxRevenue.toFixed(1)}B`;
            const epfContributions = (totalSalaries * EPF_TOTAL_RATE) / 1000000000;
            document.getElementById('pensionSavings').textContent = `RM ${epfContributions.toFixed(1)}B`;
            const socialCostsSaved = (workers * WELFARE_SAVINGS_PER_PERSON) / 1000000000;
            document.getElementById('socialCosts').textContent = `RM ${socialCostsSaved.toFixed(2)}B`;
            
            const knowledgeScore = ((retirement - 60) / 10 * 50) + (productivity * 50);
            let knowledgeLevel;
            if (knowledgeScore >= 75) knowledgeLevel = 'Very High';
            else if (knowledgeScore >= 60) knowledgeLevel = 'High';
            else if (knowledgeScore >= 45) knowledgeLevel = 'Medium';
            else knowledgeLevel = 'Low';
            document.getElementById('knowledgeValue').textContent = knowledgeLevel;
        }

        function getReportContent() {
            const workers = parseInt(document.getElementById('workersSlider').value);
            const productivity = parseFloat(document.getElementById('productivitySlider').value);
            const retirement = parseInt(document.getElementById('retirementSlider').value);
            
            return `POLICY IMPACT SIMULATOR - SCENARIO REPORT
Generated: ${new Date().toLocaleString()}

==============================================
SCENARIO PARAMETERS
==============================================
Additional Senior Workers (55+): ${workers.toLocaleString()}
Productivity Factor: ${productivity}
Retirement Age: ${retirement} years

==============================================
KEY ECONOMIC IMPACTS
==============================================
GDP Impact: ${document.getElementById('gdpImpact').textContent}
Employment Rate Increase: ${document.getElementById('employmentRate').textContent}
Workers Retained: ${document.getElementById('workersRetained').textContent}

==============================================
SECTOR BREAKDOWN
==============================================
Agriculture:
  - GDP Contribution: ${document.getElementById('agriGDP').textContent}
  - Workers: ${document.getElementById('agriWorkers').textContent}

Manufacturing:
  - GDP Contribution: ${document.getElementById('manuGDP').textContent}
  - Workers: ${document.getElementById('manuWorkers').textContent}

Services:
  - GDP Contribution: ${document.getElementById('servGDP').textContent}
  - Workers: ${document.getElementById('servWorkers').textContent}

==============================================
ADDITIONAL BENEFITS
==============================================
Tax Revenue: ${document.getElementById('taxRevenue').textContent}
Pension Savings (EPF): ${document.getElementById('pensionSavings').textContent}
Social Cost Reduction: ${document.getElementById('socialCosts').textContent}
Knowledge Retention: ${document.getElementById('knowledgeValue').textContent}

==============================================
METHODOLOGY & DATA SOURCES
==============================================
This simulation uses official data from MITI, KWSP, LHDN, DOSM, and the national budget. For a detailed breakdown, please see the Methodology section.
==============================================`;
        }

        function showReport() {
            const reportContent = getReportContent();
            document.getElementById('reportOutput').textContent = reportContent;
            document.getElementById('reportModal').classList.add('show');
            document.getElementById('copyReportBtn').textContent = 'üìã Copy to Clipboard';
        }

        function hideReport() {
            document.getElementById('reportModal').classList.remove('show');
        }

        function copyReport() {
            const reportText = document.getElementById('reportOutput').textContent;
            navigator.clipboard.writeText(reportText).then(() => {
                const copyBtn = document.getElementById('copyReportBtn');
                copyBtn.textContent = '‚úÖ Copied!';
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                alert('Could not copy report to clipboard.');
            });
        }
        
        function addMessage(text, type) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = text;
            messageDiv.appendChild(contentDiv);
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const sendBtn = document.getElementById('sendBtn');
            const message = input.value.trim();
            if (!message) return;
            addMessage(message, 'user');
            input.value = '';
            sendBtn.disabled = true;
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: message,
                        context: {
                            workers: document.getElementById('workersSlider').value,
                            productivity: document.getElementById('productivitySlider').value,
                            retirement: document.getElementById('retirementSlider').value
                        }
                    })
                });
                const data = await response.json();
                addMessage(data.response || 'Sorry, I could not process that request.', 'assistant');
            } catch (error) {
                addMessage('Error connecting to AI assistant. Please try again.', 'assistant');
            } finally {
                sendBtn.disabled = false;
            }
        }
        function askQuestion(question) {
            document.getElementById('messageInput').value = question;
            sendMessage();
        }
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        const methodologyModal = document.getElementById('methodologyModal');
        const reportModal = document.getElementById('reportModal');
        
        function showMethodology() { methodologyModal.classList.add('show'); }
        function hideMethodology() { methodologyModal.classList.remove('show'); }
        
        window.onclick = function(event) {
            if (event.target == methodologyModal) { hideMethodology(); }
            if (event.target == reportModal) { hideReport(); }
        }
        
        updateSimulation();
        addMessage('Hello! I can help you understand policy scenarios, implementation strategies, and cost estimates. What would you like to know?', 'assistant');
    </script>
</body>
</html>